### 特性

内容发布网络、一种通过互联网互相连接的电脑网络系统。 contant delivery netwoek

利用最靠近每位用户的服务器、更快、更可靠地将音乐、图片、视频、应用程序及其他文件发送给用户，来提高性能。可拓展性，及低成本的网络内容传递给用户

典型的CDN系统由下面三个部分组成

1. 分布服务系统：最基本的工作单元就是cache设备，cache（边缘cache）负责直接响应最终用户的访问请求，把缓存在本地的内容快速地提供给用户。

同时cache还负责与源站点进行内容同步，把更新的内容以及本地没有的内容从源站点获取并保存到本地。cache设备的数量、规模、总服务能力是衡量一个CDN系统服务能力的最基本的指标。

2. 负载均衡系统：主要功能实负责对所有发起服务请求的用户进行访问调查，确定提供给用户最终实际访问地址

两级调度体系分为全局负载均衡gslb和本地负载均衡slb。全局负载均衡主要根据用户就近原则，通过对每个服务节点进行最优判断，确定向用户提供服务的cache的物理位置。

本地负载均衡主要负责节点内部的设备负载均衡

3. 运营管理系统：负责处理业务层面的与外界系统交互所必须的收集、整理、交付工作，包含客户管理、产品管理、计费管理，统计分析等功能。

### 作用

托管 Web资源 文本，图片，脚本。可供下载的资源，媒体文件，软件，文档。应用程序 门户网站等。使用CDN来加速访问这些资源。

1. 在性能方面，引入CDN的作用在于：

用户收到的内容来自最近的数据中心，延迟更低，内容加载更快

部分资源请求分配给了CDN、减少了服务器的负载

2. 安全方面

1. cdn有利于防御ddos、mitm等网络攻击。

2. 针对ddos，通过监控分析异常流量，限制其请求频率。

3. 针对mitm：从源服务器到cdn节点到isp inter service provider 全链路HTTPS通信

除此之外，cdn作为一种基础的云服务，同样具有资源托管、按需扩展（能够应对流量高峰）等方面的优势。

### 原理

cdn 和 dns 有着密不可分的联系，先来看一下dns解析域名的过程

1. 检查浏览器缓存

2. 检查操作系统缓存、常见的如hosts文件、

3. 检查路由器缓存。

4. 如果前面都没找到 向isp 网络服务提供商的ldns服务器查询。

5. 如果ldns服务器没找到 向根域名服务器请求解析。分为以下几步。

- 根服务器返回顶级域名 TLD 服务器如.com等的地址 。com
- 接着向顶级域名服务器发送请求，然后会返回次级域名LSD服务器的地址 .test
- 接着向次级域名发送请求， 返回通过域名查询到的目标ip，www。test。com

local DNS Server会缓存结果，并返回给用户，缓存在系统中。

cdn工作的原理

- 用户未使用cdn缓存资源的过程
1. 浏览器通过dns对域名进行解析 上面的dns解析过程，依次得到此域名对应的ip地址。

2. 浏览器根据得到的ip地址，向域名的服务器主机发送数据请求

3. 服务器向浏览器返回响应数据。

- 用户使用cdn缓存资源的过程

1. 对于点击的数据的url，经过本地dns系统的解析，发现该url对应的是一个cdn专用的dns服务器，dns系统就会将域名解析权交给cname指向的cdn专用的dns服务器。

2. cdn专用dns服务器将cdn的全局负载均衡设备ip地址返回给用户。

3. 用户向cdn的全局负载均衡设备发送数据请求。

4. cdn的全局负载均衡设备根据用户的ip地址，以及用户请求的内容url，选择一台用户所属区域的区域负载均衡设备。告诉用户向这台设备发送请求

5. 区域负载均衡设备选择一台合适的缓存服务器来提供服务，将该缓存服务器的ip地址返回给全局负载均衡设备。

6. 全局负载均衡设备把服务器的ip地址返回给用户

7. 用户向该缓存服务器发起请求，缓存服务器响应用户的请求。将用户所需内容发送至用户终端。

如果缓存服务器没有用户想要的内容，那么缓存服务器就会向他的上一级缓存服务器发送请求内容。依次类推，直到获取到需要的资源。最后如果还是没有，就会回到自己的服务器去获取资源。

### cdn的使用场景

1. 使用第三方的cdn服务：开源

2. 使用cdn进行静态资源的缓存：将自己网站的静态资源放到cdn上，比如js，css，整个项目也可以 一键部署

3. 直播传送：直播本质上是使用流每日进行传送，cdn也是支持流媒体传送的，所以直播完全可以使用cdn来提高访问速度，cdn在处理流媒体的时候与处理普通静态文件

有所不同，普通文件如果在边缘节点还没有找到的话，就会去上一层接着寻找，但是流媒体本身数据量大，如果使用回源的方式，必然会带来性能问题，所以流媒体一般都是主动推送的方式



